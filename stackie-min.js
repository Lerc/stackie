var Stackie=function(){function v(b){m=w(b);b=new Float32Array(131072);for(var c=0;131072>c;c+=2){var a=m()*Math.PI*2;b[c]=Math.sin(a);b[c+1]=Math.cos(a)}q=b}function x(b,c){function a(a,c,d){f[c*b+a]=d}var f=new Float32Array(b*c);this.get=function(a,c){return f[c*b+a]};this.set=a;this.getImageData=function(a){a=a||n("x");for(var e=new ImageData(b,c),d=new Uint32Array(e.data.buffer),g=0;g<d.length;g++)d[g]=a(f[g]);return e};this.generate=function(f){for(var e=0;e<c;e++)for(var d=0;d<b;d++)a(d,e,f(d/
b,e/c))}}function y(){function b(a){d.push(a)}function c(a,c){return function(){b(c.apply(null,d.splice(-a,a)))}}function a(a){return function(){var c=d.pop();b(a(d.pop(),c))}}function f(a){return function(){b(a(d.pop()))}}function l(a){return function(){b(a)}}function e(a){return function(){b(d[a])}}var d,g={"*":a(function(a,b){return a*b}),"/":a(function(a,b){return a/b}),"-":a(function(a,b){return a-b}),"+":a(function(a,b){return a+b}),p:a(r),w:c(3,r),W:c(4,r),s:f(Math.sin),c:f(Math.cos),q:f(Math.sqrt),
a:a(Math.atan2),r:c(0,m),"<":a(Math.min),">":a(Math.max),l:f(Math.log),"^":a(Math.pow),P:l(Math.PI),"~":f(Math.abs),"#":f(Math.round),"!":f(function(a){return 1-a}),"?":f(function(a){return 0>=a?0:1}),":":function(){var a=d.pop(),c=d.pop();b(a);b(c)},";":function(){var a=d.pop(),c=d.pop(),f=d.pop();b(a);b(c);b(f)},d:function(){var a=d.pop();b(a);b(a)}},h;for(h in"tuvxyz")g["tuvxyz"[h]]=e("tuvxyz"[h]);for(h=0;10>h;h++)g[""+h]=l(h);return function(a,b){d=a;g[b]()}}function t(b){var c=y();return function(a,
f,l){var e=[];e.x=a;e.y=f;e.t=l;for(a=0;a<b.length;a++)c(e,b[a]);return e.pop()}}function p(b){return Math.floor(255*(0>b?0:1<b?1:b))}function n(b){b=t(b);for(var c=[],a=0;256>a;a++){var f=p(b(a/256,0)),l=p(b(a/256,.5)),e=p(b(a/256,1));c.push(e<<16|l<<8|f|4278190080)}return function(a){return c[p(a)]}}function r(b,c,a,f){function l(a,b){a%=b;return 0>a?b-a:a}function e(a,b,c){c=c*c*c*(c*(6*c-15)+10);return(1-c)*a+c*b}function d(d,e){var g=2*(l(e,f)*a+l(d,a));return(b-d)*q[g]+(c-e)*q[g+1]}a=a||256;
f=f||a;var g=Math.floor(b),h=Math.floor(c),k=b-g,p=c-h,m=g+1,n=h+1;return e(e(d(g,h),d(m,h),k),e(d(g,n),d(m,n),k),p)}function w(b){var c=b&u-1,a=173;return function(){a=36969*(a&65535)+(a>>16);c=18E3*(c&65535)+(c>>16);return((a<<16)+c&u-1)/u}}var k={},m,q;v(42);var u=1073741824;k.makeField=function(b,c){return new x(b,c)};k.program=t;k.makeRandom=w;k.setSeed=v;k.makePaletteMapper=n;k.generate=function(b,c,a){a=a||256;a=new x(a,a);c=n(c||"x");a.generate(t(b));return a.getImageData(c)};return k}();